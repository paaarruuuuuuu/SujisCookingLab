const mockRecipeData = [
{
id: 1,
title: "Spicy Cauliflower Ghee Rice (Gobi Rice)",
shortDescription: "A unique creation of fried cauliflower in a kabab masala, layered with aromatic Ghee Rice.",
category: "Dinner",
prepTime: "30 min", // Includes marinating/soaking time
cookTime: "30 min",
servings: 4,
image: "images/CauliflowerRice.jpg",
ingredients: [
"4 cups Ghee Rice, prepared",
"3 cups Cauliflower florets, washed",
"20g Kabab masala powder",
"1 Egg",
"1 tsp Ginger garlic paste (for marinade)",
"2 large onions, sliced",
"1 large tomato, chopped",
"1 green chilli, chopped",
"1 capsicum, chopped",
"1/4 tsp Turmeric powder",
"1/2 tsp Kashmiri chilli powder",
"1 tsp Coriander powder",
"1/2 tsp Garam masala powder",
"1/2 tsp Jeera powder",
"1/2 tsp Ginger garlic paste (for gravy)",
"Salt to taste",
"Oil for frying",
"Coriander leaves for garnishing"
],
instructions: [
"First, prepare your Ghee Rice and set it aside.",
"Soak the washed cauliflower florets in hot water for 30 minutes. Drain well.",
"In a bowl, combine the kabab masala powder, egg, and 1 tsp ginger garlic paste. Add the cauliflower florets, marinate well, and keep aside.",
"Heat oil in a pan and fry the marinated cauliflower florets until golden and cooked. Set aside.",
"In the remaining oil in the pan, add the sliced onions and saute till golden brown.",
"Add the chopped tomato, green chilli, and 1/2 tsp ginger garlic paste. Saute for a few minutes.",
"Add all the spice powders (Turmeric, Kashmiri chilli, Coriander, Garam masala, Jeera) and mix well. Add a little water if required to get a thick gravy.",
"Add the fried cauliflower florets and chopped capsicum into the gravy and mix well. Adjust seasonings as required, then switch off the flame.",
"In a serving bowl or casserole, spread a layer of the prepared Ghee Rice.",
"Spread a layer of the cauliflower masala on top of the rice.",
"Continue layering until all the rice and gravy is finished, ending with a layer of rice.",
"Garnish with fresh coriander leaves and serve hot."
]
},
{
id: 2,
title: "Simple Butter Chicken",
shortDescription: "A classic and creamy butter chicken recipe with tender chicken in a rich tomato sauce.",
category: "Non-Veg Curries",
prepTime: "15 min",
cookTime: "30 min",
servings: 4,
image: "images/ButterChicken.jpg",
ingredients: [
"500g boneless chicken, cut into bite-sized pieces",
"2 tablespoons butter",
"1 onion, finely chopped",
"3 cloves garlic, minced",
"1 tablespoon fresh ginger, minced",
"1 teaspoon ground turmeric",
"1 teaspoon ground cumin",
"1 teaspoon Kashmir chilli powder",
"1 teaspoon garam masala",
"1 cup tomato puree or crushed tomatoes",
"1/2 cup heavy cream",
"Salt to taste",
"Fresh cilantro for garnish (optional)"
],
instructions: [
"In a large skillet, melt the butter over medium heat. Add the chopped onion and cook until softened, about 5 minutes.",
"Add the minced garlic and ginger to the skillet and cook for another minute, until fragrant.",
"Stir in the ground turmeric, cumin, garam masala, and chili powder. Cook for 1-2 minutes, stirring constantly, until the spices are fragrant.",
"Add the chicken pieces to the skillet and cook until they are browned on all sides, about 5-7 minutes.",
"Pour in the tomato puree or crushed tomatoes and stir to combine. Bring the mixture to a simmer and let it cook for 10-15 minutes, until the chicken is cooked through and the sauce has thickened slightly.",
"Stir in the heavy cream and simmer for an additional 5 minutes.",
"Taste the butter chicken and adjust the seasoning with salt, if necessary.",
"Garnish with fresh cilantro before serving, if desired.",
"Serve the butter chicken hot with rice or naan bread. Enjoy your meal!"
]
},
{
id: 3,
title: "Chicken & Sprouted Lentil Casserole",
shortDescription: "A hearty, flavorful casserole with chicken, lentils, and pasta baked under cheesy potatoes.",
category: "Dinner",
prepTime: "30 min",
cookTime: "75 min",
servings: 6,
image: "images/CSLPC.jpg",
ingredients: [
"1.5 cups Boneless cooked chicken (diced or shredded)",
"1 cup Sprouted green gram (moong sprouts), steamed",
"1 cup Sprouted horsegram, steamed",
"1 medium Capsicum, chopped",
"1 medium Onion, chopped",
"1/2 cup Drumstick leaves",
"1 tbsp Oil",
"1/2 tsp Ginger-garlic paste (for filling)",
"1/2 tsp Turmeric powder",
"1/2 tsp Cumin powder",
"Salt and pepper to taste",
"4-5 large Potatoes, thinly sliced (approx. 1/8 inch thick)",
"1/2 cup Tomato sauce/ketchup",
"1-2 cups Shredded mozzarella cheese",
"Oregano, as required",
"Red chili flakes, as required",
"2 cups Pasta, uncooked",
"2 tbsp Butter",
"5-6 cloves Garlic, chopped",
"1 cup Milk",
"1-2 Cheese slices",
"A few Spinach leaves, chopped"
],
instructions: [
"Preheat oven to 180°C. Lightly grease a medium-sized casserole dish.",
"Cook the 2 cups of pasta according to package directions. Drain and set aside.",
"Prepare the Pasta Sauce: Heat 2 tbsp butter in a pan, add chopped garlic and saute. Add chopped spinach leaves and saute until wilted.",
"Pour in 1 cup of milk and add 1-2 cheese slices. Stir until you have a creamy sauce. Add the cooked pasta and mix well. Sprinkle with some oregano, chili flakes, salt, and pepper. Set this pasta mixture aside.",
"Prepare the Filling: Heat 1 tbsp oil in a separate pan over medium heat. Sauté the chopped onion until translucent.",
"Add 1/2 tsp ginger-garlic paste and cook for 1 minute. Add capsicum and drumstick leaves, cooking until the capsicum softens and the leaves wilt (about 5 minutes).",
"Stir in the cooked chicken, steamed sprouted lentils (green gram and horsegram), turmeric, cumin, salt, and pepper. Mix well and cook for 2-3 minutes. Remove from heat.",
"Assemble Layer 1 (Potatoes): Arrange half of the thinly sliced potatoes in an overlapping pattern to cover the base of the dish.",
"Assemble Layer 2 (Red Sauce): Drizzle half (1/4 cup) of the tomato ketchup over the potato slices.",
"Assemble Layer 3 (Filling): Spread the chicken and sprouted lentil mixture evenly over the potatoes.",
"Assemble Layer 4 (Potatoes): Arrange the remaining potato slices on top of the filling and spread the remaining tomato sauce.",
"Assemble Layer 5 (Pasta): Spread the prepared creamy pasta mixture on top.",
"Assemble Layer 6 (Cheese): Top evenly with 1-2 cups of shredded mozzarella cheese. Sprinkle with oregano and chili flakes.",
"Bake: Cover the dish tightly with aluminum foil and bake for 30-40 minutes.",
"Remove the foil and bake for an additional 15-20 minutes, or until the potatoes are tender and the cheese is melted and golden brown.",
"Let the casserole cool for 5-10 minutes before slicing and serving."
]
},
];

// --- Global State ---
let currentFilter = 'All';
let currentSearchTerm = '';
let currentTheme = 'light';

// --- Global Navigation Functions ---
// These are defined on the window object so inline `onclick` attributes can find them.
function navigateTo(pageId, recipeId = null) {
  // Hide all pages
  document.querySelectorAll('.page-content').forEach(page => {
    page.classList.add('hidden');
  });

  // Show the target page
  const targetPage = document.getElementById(`page-${pageId}`);
  if (targetPage) {
    targetPage.classList.remove('hidden');
    // Add fade-in animation
    targetPage.classList.remove('page-fade-in');
    void targetPage.offsetWidth; // Trigger reflow
    targetPage.classList.add('page-fade-in');
  }

  // Handle Recipe Detail Page
  if (pageId === 'recipe-detail' && recipeId) {
    const recipe = mockRecipeData.find(r => r.id === recipeId);
    if (recipe) {
      document.getElementById('page-recipe-detail').innerHTML = renderRecipeDetail(recipe);
    }
  }

  // Update active nav button
  document.querySelectorAll('.nav-button').forEach(button => {
    button.classList.remove('bg-amber-500', 'text-white', 'dark:bg-amber-400', 'dark:text-black');
    button.classList.add('text-stone-600', 'dark:text-gray-300');
    if (button.id.includes(pageId)) {
      button.classList.add('bg-amber-500', 'text-white', 'dark:bg-amber-400', 'dark:text-black');
      button.classList.remove('text-stone-600', 'dark:text-gray-300');
    }
  });

  // Close mobile menu on navigation
  const mobileMenu = document.getElementById('mobile-menu');
  if (mobileMenu.classList.contains('max-h-96')) {
    handleMobileMenuToggle();
  }

  // Scroll to top
  window.scrollTo(0, 0);
  
  // *** CORE FIX: Redraw all icons on every page navigation ***
  lucide.createIcons();
}
window.navigateTo = navigateTo; // Expose to global scope

function viewRecipe(recipeId) {
  navigateTo('recipe-detail', recipeId);
}
window.viewRecipe = viewRecipe; // Expose to global scope


// --- Theme Logic ---
function setTheme(theme) {
  currentTheme = theme;
  const root = document.documentElement;
  const sunIcons = document.querySelectorAll('[id*="theme-icon-sun"]');
  const moonIcons = document.querySelectorAll('[id*="theme-icon-moon"]');
  
  if (theme === 'dark') {
    root.classList.add('dark');
    sunIcons.forEach(icon => icon.classList.remove('hidden'));
    moonIcons.forEach(icon => icon.classList.add('hidden'));
  } else {
    root.classList.remove('dark');
    sunIcons.forEach(icon => icon.classList.add('hidden'));
    moonIcons.forEach(icon => icon.classList.remove('hidden'));
  }
  localStorage.setItem('theme', theme);
  
  // Redraw icons in case their color changed
  lucide.createIcons();
}

function toggleTheme() {
  setTheme(currentTheme === 'dark' ? 'light' : 'dark');
}

// --- Mobile Menu Toggle ---
function handleMobileMenuToggle() {
  const mobileMenu = document.getElementById('mobile-menu');
  const openIcon = document.getElementById('mobile-menu-icon-open');
  const closeIcon = document.getElementById('mobile-menu-icon-close');

  if (mobileMenu.classList.contains('max-h-96')) {
    mobileMenu.classList.remove('max-h-96', 'opacity-100');
    mobileMenu.classList.add('max-h-0', 'opacity-0');
    openIcon.classList.remove('hidden');
    closeIcon.classList.add('hidden');
  } else {
    mobileMenu.classList.remove('max-h-0', 'opacity-0');
    mobileMenu.classList.add('max-h-96', 'opacity-100');
    openIcon.classList.add('hidden');
    closeIcon.classList.remove('hidden');
  }
}

// --- Rendering Functions ---
function renderRecipeCard(recipe) {
  return `
    <div
      class="bg-white dark:bg-gray-900 rounded-xl overflow-hidden shadow-lg dark:shadow-2xl dark:shadow-black/50 group cursor-pointer transition-all duration-300 hover:shadow-amber-600/20 dark:hover:shadow-amber-400/20 hover:-translate-y-2 border border-stone-200 dark:border-gray-800 hover:border-amber-600/50 dark:hover:border-amber-400/50"
      onclick="viewRecipe(${recipe.id})"
    >
      <div class="relative h-56 w-full overflow-hidden">
        <img
          src="${recipe.image}"
          alt="${recipe.title}"
          class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
          onerror="this.src='https://placehold.co/800x600/2D2D2D/E0C097?text=Image+Error'"
        />
        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
        <span class="absolute top-4 left-4 bg-amber-500 text-white dark:bg-amber-400 dark:text-black text-xs font-bold px-3 py-1 rounded-full shadow-lg">
          ${recipe.category}
        </span>
      </div>
      <div class="p-6">
        <h3 class="text-2xl font-serif font-bold text-stone-800 dark:text-white group-hover:text-amber-600 dark:group-hover:text-amber-400 transition-colors duration-300">
          ${recipe.title}
        </h3>
        <p class="text-stone-600 dark:text-gray-400 mt-2 text-sm">
          ${recipe.shortDescription}
        </p>
        <div class="flex items-center justify-between mt-4 text-stone-500 dark:text-gray-500 text-sm">
          <div class="flex items-center gap-1.5">
            <i data-lucide="clock" style="width: 16px; height: 16px;"></i>
            <span>${recipe.prepTime}</span>
          </div>
          <div class="flex items-center gap-1.5">
            <i data-lucide="soup" style="width: 16px; height: 16px;"></i>
            <span>${recipe.cookTime}</span>
          </div>
          <div class="flex items-center gap-1.5">
            <i data-lucide="users" style="width: 16px; height: 16px;"></i>
            <span>${recipe.servings} servings</span>
          </div>
        </div>
      </div>
    </div>
  `;
}

function renderRecipeDetail(recipe) {
  return `
    <button
      onclick="navigateTo('recipes')"
      class="flex items-center gap-2 text-amber-600 dark:text-amber-400 font-medium mb-6 transition-colors hover:text-amber-700 dark:hover:text-amber-300"
    >
      <i data-lucide="arrow-left" style="width: 20px; height: 20px;"></i>
      Back to Recipe Index
    </button>

    <div class="bg-white dark:bg-gray-900 rounded-xl shadow-xl dark:shadow-2xl dark:shadow-black/50 overflow-hidden border border-stone-200 dark:border-gray-800">
      <div class="relative h-[44rem] w-full">
        <img
  src="${recipe.image}"
  alt="${recipe.title}"
  class="w-full h-full object-cover"
  style="object-position: center 75%;"
  onerror="this.src='https.placehold.co/1200x400/2D2D2D/E0C097?text=Premium+Dish'"
/>
        <div class="absolute inset-0 bg-gradient-to-t from-gray-900 to-transparent"></div>
        <div class="absolute bottom-8 left-8">
          <span class="bg-amber-500 text-white dark:bg-amber-400 dark:text-black text-sm font-bold px-3 py-1 rounded-full shadow-lg">
            ${recipe.category}
          </span>
          <h1 class="text-5xl font-serif font-bold text-white mt-2 text-shadow-lg">
            ${recipe.title}
          </h1>
        </div>
      </div>
      
      <div class="p-8 md:p-12">
        <p class="text-lg text-stone-700 dark:text-gray-300 mb-8 max-w-3xl">
          ${recipe.shortDescription}
        </p>

        <!-- Meta Info -->
        <div class="flex flex-wrap gap-6 mb-10 border-y border-stone-200 dark:border-gray-700 py-6">
          <div class="flex items-center gap-3 text-stone-800 dark:text-white">
            <i data-lucide="clock" class="text-amber-600 dark:text-amber-400" style="width: 24px; height: 24px;"></i>
            <div>
              <span class="text-sm text-stone-600 dark:text-gray-400 block">Prep Time</span>
              <span class="text-lg font-medium">${recipe.prepTime}</span>
            </div>
          </div>
          <div class="flex items-center gap-3 text-stone-800 dark:text-white">
            <i data-lucide="soup" class="text-amber-600 dark:text-amber-400" style="width: 24px; height: 24px;"></i>
            <div>
              <span class="text-sm text-stone-600 dark:text-gray-400 block">Cook Time</span>
              <span class="text-lg font-medium">${recipe.cookTime}</span>
            </div>
          </div>
          <div class="flex items-center gap-3 text-stone-800 dark:text-white">
            <i data-lucide="users" class="text-amber-600 dark:text-amber-400" style="width: 24px; height: 24px;"></i>
            <div>
              <span class="text-sm text-stone-600 dark:text-gray-400 block">Servings</span>
              <span class="text-lg font-medium">${recipe.servings}</span>
            </div>
          </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
          <!-- Ingredients -->
          <div class="lg:col-span-1">
            <h2 class="text-3xl font-serif font-bold text-amber-600 dark:text-amber-400 mb-6">
              Ingredients
            </h2>
            <ul class="space-y-3">
              ${recipe.ingredients.map(ingredient => `
                <li class="flex items-center gap-3">
                  <span class="h-2 w-2 bg-amber-600 dark:bg-amber-400 rounded-full flex-shrink-0"></span>
                  <span class="text-stone-700 dark:text-gray-300">${ingredient}</span>
                </li>
              `).join('')}
            </ul>
          </div>

          <!-- Instructions -->
          <div class="lg:col-span-2">
            <h2 class="text-3xl font-serif font-bold text-amber-600 dark:text-amber-400 mb-6">
              Instructions
            </h2>
            <ol class="space-y-6">
              ${recipe.instructions.map((step, index) => `
                <li class="flex items-start gap-4">
                  <div class="flex-shrink-0 w-8 h-8 bg-amber-500 dark:bg-amber-400 text-white dark:text-black font-bold rounded-full flex items-center justify-center mt-1">
                    ${index + 1}
                  </div>
                  <p class="text-stone-700 dark:text-gray-300 leading-relaxed">${step}</p>
                </li>
              `).join('')}
            </ol>
          </div>
        </div>
      </div>
    </div>
  `;
}

function renderRecipeGrid() {
  const grid = document.getElementById('recipe-grid');
  const noResults = document.getElementById('recipe-no-results');
  
  const filteredRecipes = mockRecipeData
    .filter(recipe => currentFilter === 'All' || recipe.category === currentFilter)
    .filter(recipe => 
      recipe.title.toLowerCase().includes(currentSearchTerm.toLowerCase()) ||
      recipe.shortDescription.toLowerCase().includes(currentSearchTerm.toLowerCase())
    );
  
  if (filteredRecipes.length === 0) {
    grid.innerHTML = '';
    noResults.classList.remove('hidden');
  } else {
    grid.innerHTML = filteredRecipes.map(renderRecipeCard).join('');
    noResults.classList.add('hidden');
  }
  
  // *** CORE FIX: Redraw icons on the new cards ***
  lucide.createIcons();
}

function renderFilterButtons() {
  const container = document.getElementById('recipe-filter-buttons');
  const categories = ['All', 'Breakfast', 'Rice Dishes', 'Indian Breads', 'Pizza/Pasta/Noodles', 'Veg Curries', 'Non-Veg Curries', 'Veg Sides', 'Non-Veg Sides', 'Snacks', 'Dinner', 'Beverages', 'Desserts'];
  
  categories.forEach(category => {
    const button = document.createElement('button');
    button.textContent = category;
    button.className = `filter-button px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-300 ${
      category === 'All'
        ? 'bg-amber-500 text-white dark:bg-amber-400 dark:text-black shadow'
        : 'bg-stone-100 dark:bg-gray-800 text-stone-600 dark:text-gray-300 hover:bg-stone-200 dark:hover:bg-gray-700'
    }`;
    button.onclick = () => {
      currentFilter = category;
      // Update button styles
      document.querySelectorAll('.filter-button').forEach(btn => {
        btn.classList.remove('bg-amber-500', 'text-white', 'dark:bg-amber-400', 'dark:text-black', 'shadow');
        btn.classList.add('bg-stone-100', 'dark:bg-gray-800', 'text-stone-600', 'dark:text-gray-300', 'hover:bg-stone-200', 'dark:hover:bg-gray-700');
      });
      button.classList.add('bg-amber-500', 'text-white', 'dark:bg-amber-400', 'dark:text-black', 'shadow');
      button.classList.remove('bg-stone-100', 'dark:bg-gray-800', 'text-stone-600', 'dark:text-gray-300', 'hover:bg-stone-200', 'dark:hover:bg-gray-700');
      // Re-render grid
      renderRecipeGrid();
    };
    container.appendChild(button);
  });
}

function renderFeaturedRecipes() {
  const container = document.getElementById('featured-recipes');
  container.innerHTML = mockRecipeData.slice(0, 3).map(renderRecipeCard).join('');
  
  // *** CORE FIX: Redraw icons on the new cards ***
  lucide.createIcons();
}

// --- Event Handlers ---
function handleContactSubmit(event) {
  event.preventDefault();
  const form = event.target;
  const submitButton = document.getElementById('contact-submit-button');
  const buttonText = document.getElementById('contact-submit-text');
  const buttonAnimation = document.getElementById('contact-submit-animation');
  const successMessage = document.getElementById('contact-success-message');

  const name = form.elements.name.value;
  const email = form.elements.email.value;
  const message = form.elements.message.value;

  submitButton.disabled = true;
  buttonText.classList.add('hidden');
  buttonAnimation.classList.remove('hidden');

  // *** CORE FIX: Redraw the new 'send' icon ***
  lucide.createIcons();

  // Simulate animation and mail client opening
  setTimeout(() => {
    const subject = `Message from ${name} via SujisCookingLab`;
    const body = `Name: ${name}\nEmail: ${email}\n\nMessage:\n${message}`;
    const mailtoLink = `mailto:watscookingin@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    
    window.location.href = mailtoLink;

    // Reset form
    submitButton.disabled = false;
    buttonText.classList.remove('hidden');
    buttonAnimation.classList.add('hidden');
    successMessage.classList.remove('hidden');
    form.reset();

    // Clear "Sent!" message after a few seconds
    setTimeout(() => successMessage.classList.add('hidden'), 4000);
  }, 1500); // 1.5 second animation delay
}

// --- App Initialization ---
// This runs after the DOM is fully loaded
document.addEventListener('DOMContentLoaded', () => {
  const loadingScreen = document.getElementById('loading-screen');
  const appContent = document.getElementById('app-content');
  const viewCountSpan = document.getElementById('view-count-span');
  // --- WORKING VIEW COUNTER LOGIC ---
  let count = localStorage.getItem('siteViewCount');
  
  if (count) {
    // If a count exists, parse it to a number and add 1
    count = parseInt(count, 10) + 1;
  } else {
    // If no count exists, start with a random base number
    count = 1;
  }
  
  // Save the new, updated count back to storage
  localStorage.setItem('siteViewCount', count);
  // --- END OF NEW LOGIC ---

  // 1. Set initial theme
  const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
  setTheme(savedTheme);

  // 2. Set up event listeners
  document.getElementById('theme-toggle').onclick = toggleTheme;
  document.getElementById('theme-toggle-mobile').onclick = toggleTheme;
  document.getElementById('mobile-menu-button').onclick = handleMobileMenuToggle;
  document.getElementById('contact-form').onsubmit = handleContactSubmit;
  
  document.getElementById('recipe-search-input').oninput = (e) => {
    currentSearchTerm = e.target.value;
    renderRecipeGrid();
  };

  // 3. Initial Renders
  renderFilterButtons();
  renderRecipeGrid();
  renderFeaturedRecipes();
  
  // 4. Set initial view count
  viewCountSpan.textContent = count.toLocaleString();

  // 5. Create Lucide icons
  // This is the main call that runs on page load
  lucide.createIcons();
  
  // 6. Hide loading screen, show app
  setTimeout(() => {
    loadingScreen.style.opacity = '0';
    // Use setTimeout to remove from DOM after fade-out
    setTimeout(() => loadingScreen.classList.add('hidden'), 500);
    appContent.classList.remove('hidden');
    
    // *** CORE FIX: Redraw icons *after* the app is visible ***
    // This makes sure the icons in the header and on the homepage are drawn.
    lucide.createIcons();
    
  }, 2500); // Show loading screen for 2.5 seconds
  
  // 7. Set initial page state
  navigateTo('home');

});

